!function(t,e){"function"==typeof define&&define.amd?define(["react","underscore"],e):"object"==typeof exports?module.exports=e(require("react"),require("underscore")):t.InfiniteListComponent=e(t.React)}(this,function(t,e){var i,n,s,o,r,a;t=window.React,i=function(){return window.innerHeight},n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1)}}(),s=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}(),o={},o.DEFAULT_ITEM_HEIGHT=35,o.MARGIN_BOTTOM=0,o.MARGIN_OUT_SCREEN=10*o.DEFAULT_ITEM_HEIGHT;var r=t.createClass({displayName:"InfiniteListComponent",componentDidMount:function(){this._configuration=e.extend(o,this.props.config),this.setState({initialOffsetTop:this.getDOMNode().offsetTop,viewPortHeight:i()-this.getDOMNode().offsetTop-this._configuration.MARGIN_BOTTOM,listHeight:this.getListFullHeight()}),this.keepDisplayInSync()},getInitialState:function(){return{startIdx:0,endIdx:30,offsetTop:0,differential:!1}},componentWillReceiveProps:function(){this.setState({viewPortHeight:i()-this.getDOMNode().offsetTop-this._configuration.MARGIN_BOTTOM,listHeight:this.getListFullHeight()})},componentWillUpdate:function(t,i){var n,s,o;i.differential&&(o=this,s=0,console.log("UPDATE LOOP TRIGGERED"),e.each(this.props.children,function(t,e){var r,a,h,d,f,c;n="infinite-list-item-"+e,r=o.refs[n],a=e>=this.state.startIdx&&e<=this.state.endIdx,h=e>=i.startIdx&&e<=i.endIdx,f=h&&!a,c=!h&&a,d=i.startIdx>this.state.startIdx?"down":"up","up"===d&&f&&e<=this.state.startIdx&&(r&&r.state.cachedHeight||console.log("height was not computed"),s-=r.state.cachedHeight),"down"===d&&c&&e<i.startIdx&&(r&&r.state.cachedHeight||console.log("height was not computed"),s+=r.state.cachedHeight)},this),i.offsetTop=i.offsetTop+s)},componentDidUpdate:function(){this.state.listRealHeight=this.refs["list-rendered"].getDOMNode().scrollHeight,this.state.offsetBottom=this.state.offsetTop+this.state.listRealHeight},render:function(){var i,n,s,o,r,h;if(!this.state.viewPortHeight)return t.createElement("div",null);this.oldScroll=this.getScroll(),h=this,i={height:this.state.viewPortHeight,webkitOverflowScrolling:"touch",overflowY:"auto",width:"100%",position:"relative"},n={WebkitTransform:"translate(0, "+(this.state.offsetTop||0)+"px)",MozTransform:"translate(0, "+(this.state.offsetTop||0)+"px)"},s={height:this.state.listHeight},o=this.state.startIdx,r=this.state.endIdx;var d=e.map(this.props.children,function(e,i){var n,s;if(!(o-20>i||i>r+20))return n="infinite-list-item-"+i,s=i>=o&&r>=i,t.createElement(a,{rendered:s,key:i,ref:n},e)});return t.createElement("div",{style:i},t.createElement("div",{style:s},t.createElement("div",{className:"hidden-infinite-list-buffer",refs:"hidden-buffer"}),t.createElement("div",{style:n,ref:"list-rendered"},d)))},keepDisplayInSync:function(){function t(){n(function(){e.rePositionList.call(e,e.getScroll())})}var e=this;this.displaySyncInterval=window.setInterval(t,1)},tearDownDisplayUpdate:function(){window.clearInterval(this.displaySyncInterval)},getScroll:function(){return this.getDOMNode().scrollTop},getListFullHeight:function(){var t=this.props.children.length;return t*this._configuration.DEFAULT_ITEM_HEIGHT||0},rePositionList:function(t){var e=t<this.oldScroll,i=t>this.oldScroll,n=t<this.state.offsetTop,s=t+this.state.viewPortHeight>this.state.offsetBottom,o=0==this.state.startIdx,r=this.state.endIdx==this.props.children.length;this.oldScroll=t,e&&o&&0==this.state.startIdx||i&&r||(n||s?this.approximateInsertion(t):i?this.repositionListDown(t):e&&this.repositionListUp(t))},repositionListUp:function(t){var e,i,s,o,r;if(r=this,o=this.state.offsetBottom<t+this.state.viewPortHeight+this._configuration.MARGIN_OUT_SCREEN/2,e=t-2*this._configuration.MARGIN_OUT_SCREEN,i=Math.max((this.state.offsetTop-e)/this._configuration.DEFAULT_ITEM_HEIGHT,0),s=this.state.startIdx-i<=0,!o&&i>3||s){i=Math.min(i,this.state.startIdx);var a=this.computeNextIndexesAndBuffer("up",i);n(function(){r.setState({startIdx:a.nextStartIdx,endIdx:a.nextEndIdx,differential:!0})})}},repositionListDown:function(t){var e,i,s,o,r;if(e=this,o=t-this.offsetTop<this._configuration.MARGIN_OUT_SCREEN/2,i=t+this.state.viewPortHeight+2*this._configuration.MARGIN_OUT_SCREEN,s=Math.max((i-this.state.offsetBottom)/this._configuration.DEFAULT_ITEM_HEIGHT,0),r=this.state.endIdx+s>=this.props.children.length,!o&&s>3||r){s=Math.min(s,this.props.children.length-this.state.endIdx);var a=this.computeNextIndexesAndBuffer("down",s);n(function(){e.setState({startIdx:a.nextStartIdx,endIdx:a.nextEndIdx,differential:!0})})}},approximateInsertion:function(t){var e,i,n;e=this.props.children.length,i=Math.round(t*e/this.getListFullHeight()),n=Math.round(i+30),this.offsetTop=t-this.state.viewPortHeight,this.offsetTop=this.offsetTop<=0?0:this.offsetTop,this.setState({startIdx:i,endIdx:n,offsetTop:this.offsetTop,differential:!1})},computeNextIndexesAndBuffer:function(t,i){var n,s,o,r,a,h,d;return n=this,a=0,"up"===t?(h=this.state.startIdx-i,d=this.state.endIdx-i,s=this.state.startIdx-i,o=this.state.startIdx):"down"===t&&(h=this.state.startIdx+i,d=this.state.endIdx+i,s=this.state.endIdx,o=this.state.endIdx+i),h=Math.round(h),d=Math.round(d),s=Math.round(s),o=Math.round(o),r=this.props.children.slice(s,o),e.each(r,function(t,e){n.refs["infinite-list-item-"+(s+e)]&&!n.refs["infinite-list-item-"+(s+e)].state.cachedHeight&&n.refs["infinite-list-item-"+(s+e)].setState({rendered:!0,buffer:!0})},this),{nextStartIdx:h,nextEndIdx:d}}}),a=t.createClass({displayName:"InfiniteListItem",getInitialState:function(){return{}},componentDidMount:function(){this.getDOMNode()&&(this.state.cachedHeight=this.getDOMNode().offsetHeight)},componentDidUpdate:function(){this.getDOMNode()&&(this.state.cachedHeight=this.getDOMNode().offsetHeight)},shouldComponentUpdate:function(t){var e;return this.props?e=this.props.rendered!=t.rendered:!0},render:function(){var e;return this.props.rendered?(e={},e.overflow="hidden",this.props.buffer&&(e.position=absolute,e.top="-1000px;"),t.createElement("div",{style:e},this.props.children)):!1}});return r});
